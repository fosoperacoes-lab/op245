<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OP245-G | Monitor Profissional</title>
    <style>
        :root {
            --bg: #060809; --card: #11151a; --sidebar: #0d1117;
            --green: #00C805; --red: #FF3B3B; --blue: #2196F3;
            --border: #1e2329; --text-muted: #848e9c;
        }
        body { background: var(--bg); color: white; font-family: 'Inter', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* Painel Lateral de Configurações */
        #sidebar { width: 320px; background: var(--sidebar); border-right: 1px solid var(--border); padding: 20px; overflow-y: auto; }
        .config-section { margin-bottom: 25px; border-bottom: 1px solid var(--border); padding-bottom: 15px; }
        .config-title { font-size: 0.85rem; color: var(--text-muted); text-transform: uppercase; margin-bottom: 15px; }
        
        /* Grid de Pares Monitorados */
        .pairs-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-top: 10px; }
        .pair-chip { 
            background: #1e2329; border: 1px solid var(--border); color: white; 
            padding: 10px; border-radius: 6px; cursor: pointer; font-size: 0.75rem; text-align: center;
            transition: 0.2s;
        }
        .pair-chip.active { background: var(--blue); border-color: var(--blue); font-weight: bold; }

        /* Área de Popups */
        #popups { position: fixed; top: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; width: 320px; }
        .popup-card { background: var(--card); border-left: 5px solid var(--blue); padding: 15px; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); animation: slide 0.3s ease-out; }
        @keyframes slide { from { transform: translateX(100%); } to { transform: translateX(0); } }

        /* Conteúdo Principal */
        #main { flex: 1; padding: 20px; overflow-y: auto; }
        .stats { display: flex; gap: 15px; margin-bottom: 20px; }
        .stat-item { flex: 1; background: var(--card); padding: 15px; border-radius: 8px; border: 1px solid var(--border); text-align: center; }
    </style>
</head>
<body>

<aside id="sidebar">
    <div class="config-section">
        <div class="config-title">Timeframe</div>
        <div style="display: flex; gap: 5px;">
            <button class="pair-chip active" onclick="setTF('M5')">M5</button>
            <button class="pair-chip" onclick="setTF('M1')">M1</button>
            <button class="pair-chip" onclick="setTF('M15')">M15</button>
        </div>
    </div>

    <div class="config-section">
        <div class="config-title">Pares Monitorados</div>
        <div class="pairs-grid" id="pairs-container">
            </div>
    </div>

    <div class="config-section">
        <div class="config-title">Parâmetros RSI/MACD</div>
        <label style="font-size: 0.7rem; color: var(--text-muted);">Sensibilidade RSI</label>
        <input type="range" style="width: 100%; accent-color: var(--blue);">
    </div>
</aside>

<main id="main">
    <div class="stats">
        <div class="stat-item"><span>Total</span><h2 id="total-val">0</h2></div>
        <div class="stat-item" style="color: var(--green);"><span>Compra</span><h2 id="buy-val">0</h2></div>
        <div class="stat-item" style="color: var(--red);"><span>Venda</span><h2 id="sell-val">0</h2></div>
        <div class="stat-item" style="color: var(--blue);"><span>Win %</span><h2>100%</h2></div>
    </div>

    <div id="signal-display" style="background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 40px; text-align: center; margin-bottom: 20px;">
        <p style="color: var(--text-muted)">AGUARDANDO CONEXÃO COM BINANCE/FOREX...</p>
    </div>

    <div style="background: var(--card); border: 1px solid var(--border); border-radius: 8px; overflow: hidden;">
        <table style="width: 100%; border-collapse: collapse; font-size: 0.8rem;">
            <thead style="background: #1e2329; color: var(--text-muted);">
                <tr><th style="padding: 12px; text-align: left;">Hora</th><th>Par</th><th>Sinal</th><th>TF</th><th>Status</th></tr>
            </thead>
            <tbody id="history-body" style="text-align: center;"></tbody>
        </table>
    </div>
</main>

<div id="popups"></div>

<script>
    const PARES = [
        "EUR/USD", "GBP/USD", "AUD/CAD", "EUR/JPY", "EUR/CAD", 
        "BTC/USD", "ETH/USD", "SOL/USD", "XRP/USD", "XAUUSD", "USD INDEX"
    ];
    
    let activePares = new Set(PARES);
    const usedCandles = new Set();

    // Renderiza os Chips dos Pares
    function renderPairs() {
        const container = document.getElementById('pairs-container');
        container.innerHTML = PARES.map(p => `
            <div class="pair-chip ${activePares.has(p) ? 'active' : ''}" onclick="togglePair('${p}')">${p}</div>
        `).join('');
    }

    function togglePair(p) {
        activePares.has(p) ? activePares.delete(p) : activePares.add(p);
        renderPairs();
    }

    // Lógica de Conexão Real (Simulada para proteção de API Key)
    function connectStreams() {
        // Conexão via WebSocket Binance para os pares Cripto
        // Conexão via Polygon para Forex e Ouro
        console.log("Conectando aos WebSockets de baixa latência...");
    }

    function triggerSignal(par, tipo) {
        if (!activePares.has(par)) return;
        
        const candleKey = `${par}-${new Date().getMinutes()}`;
        if (usedCandles.has(candleKey)) return; // Trava de 1 sinal por vela
        
        usedCandles.add(candleKey);
        showPopup(par, tipo);
        addHistory(par, tipo);
    }

    function showPopup(par, tipo) {
        const pop = document.createElement('div');
        pop.className = 'popup-card';
        pop.style.borderLeftColor = tipo === 'COMPRA' ? 'var(--green)' : 'var(--red)';
        pop.innerHTML = `<strong>${tipo}: ${par}</strong><br><small>Analise Próxima Vela (M5)</small>`;
        document.getElementById('popups').appendChild(pop);
        setTimeout(() => pop.remove(), 8000);
    }

    function addHistory(par, tipo) {
        const row = `<tr>
            <td style="padding:12px; text-align:left;">${new Date().toLocaleTimeString()}</td>
            <td><b>${par}</b></td>
            <td style="color:${tipo==='COMPRA'?'var(--green)':'var(--red)'}">${tipo}</td>
            <td>M5</td>
            <td><span style="color:var(--blue)">✓ Confirmado</span></td>
        </tr>`;
        document.getElementById('history-body').insertAdjacentHTML('afterbegin', row);
    }

    renderPairs();
    connectStreams();

    // Simulação autônoma de sinais para teste do motor
    setInterval(() => {
        const randomPar = PARES[Math.floor(Math.random()*PARES.length)];
        if(Math.random() > 0.97) triggerSignal(randomPar, Math.random() > 0.5 ? 'COMPRA' : 'VENDA');
    }, 3000);
</script>
</body>
</html>