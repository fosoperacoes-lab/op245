<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OP245-G Sinais v3.6</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-body: #050a0e; --bg-sidebar: #0b1217; --bg-card: #0e161e;
            --border: #1c262e; --text-main: #e1e4e8; --text-dim: #707a8a;
            --green: #00c805; --red: #ff3b3b; --blue: #2196f3; --yellow: #f3ba2f;
        }

        body { 
            background: var(--bg-body); color: var(--text-main); font-family: 'Inter', sans-serif; 
            margin: 0; display: flex; height: 100vh; overflow: hidden; font-size: 13px;
        }

        /* HEADER */
        .top-nav {
            position: fixed; top: 0; left: 0; right: 0; height: 45px;
            background: var(--bg-sidebar); border-bottom: 1px solid var(--border);
            display: flex; justify-content: space-between; align-items: center; padding: 0 20px; z-index: 1000;
        }

        /* SIDEBAR */
        #sidebar { 
            width: 320px; background: var(--bg-sidebar); border-right: 1px solid var(--border); 
            padding: 60px 15px 15px; overflow-y: auto; height: 100%;
            transition: transform 0.3s ease, margin-left 0.3s ease;
        }
        #sidebar.hidden { margin-left: -320px; }
        
        /* SCROLLBAR CUSTOMIZADA */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-sidebar); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

        /* CONTE칔DO PRINCIPAL */
        #main { flex: 1; padding: 65px 20px 20px; overflow-y: auto; transition: 0.3s; }

        /* ESTAT칈STICAS E TABELA */
        .stats-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 12px; margin-bottom: 25px; }
        .stat-card { background: var(--bg-card); padding: 15px; border-radius: 6px; border: 1px solid var(--border); }
        .stat-card span { color: var(--text-dim); font-size: 11px; display: block; margin-bottom: 5px; }
        .stat-card h2 { margin: 0; font-size: 20px; font-weight: 600; }

        .table-section { background: var(--bg-card); border: 1px solid var(--border); border-radius: 8px; overflow: hidden; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #0c141b; color: var(--text-dim); padding: 12px; font-size: 10px; text-transform: uppercase; text-align: left; border-bottom: 1px solid var(--border); }
        td { padding: 10px 12px; border-bottom: 1px solid #141d26; font-size: 12px; }

        /* BADGES & BOTOES */
        .badge-buy { color: var(--green); border: 1px solid var(--green); padding: 3px 8px; border-radius: 4px; font-weight: bold; font-size: 10px; }
        .badge-sell { color: var(--red); border: 1px solid var(--red); padding: 3px 8px; border-radius: 4px; font-weight: bold; font-size: 10px; }
        .icon-btn { cursor: pointer; font-size: 18px; padding: 5px; border-radius: 4px; transition: 0.2s; display: inline-flex; }
        .icon-btn:hover { background: var(--border); }
        
        /* CONTROLES MULTI-SELE칂츾O */
        .grid-tags { display: grid; gap: 5px; margin-top: 8px; }
        .grid-2 { grid-template-columns: 1fr 1fr; }
        .grid-3 { grid-template-columns: 1fr 1fr 1fr; }
        .grid-4 { grid-template-columns: repeat(4, 1fr); }
        
        .tag-btn { 
            background: #1e2329; border: 1px solid var(--border); padding: 8px 4px; 
            font-size: 10px; text-align: center; border-radius: 4px; cursor: pointer; color: var(--text-dim); transition: 0.2s;
        }
        .tag-btn.active { background: rgba(33, 150, 243, 0.15); border-color: var(--blue); color: var(--blue); font-weight: bold; }
        .tag-btn:hover:not(.active) { border-color: #3b4554; }

        /* SLIDERS AVAN칂ADOS */
        .config-block { margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 15px; }
        .config-block:last-child { border-bottom: none; }
        .slider-row { margin-top: 12px; }
        .slider-header { display: flex; justify-content: space-between; font-size: 11px; color: var(--text-dim); margin-bottom: 4px; }
        .slider-header b { color: var(--text-main); font-weight: normal; }
        input[type="range"] { width: 100%; height: 3px; background: #2b3139; outline: none; -webkit-appearance: none; border-radius: 2px; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 12px; height: 12px; background: var(--blue); border-radius: 50%; cursor: pointer; }

        #popup-container { position: fixed; top: 60px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .popup-alert { background: var(--bg-sidebar); border: 1px solid var(--border); border-left: 4px solid var(--blue); padding: 15px; border-radius: 6px; width: 260px; animation: slideIn 0.3s ease-out; pointer-events: all; }
        @keyframes slideIn { from { transform: translateX(110%); } to { transform: translateX(0); } }
    </style>
</head>
<body>

<nav class="top-nav">
    <div style="display:flex; align-items:center; gap:10px;">
        <span class="icon-btn" onclick="toggleSidebar()">丘뙖잺</span>
        <span style="color:var(--blue); font-weight:bold; margin-left: 10px;">OP245-G Sinais v3.6</span>
    </div>
    <div style="display:flex; gap:15px; align-items:center;">
        <span id="btn-audio" class="icon-btn" onclick="toggleAudio()">游댉</span>
        <span id="btn-pause" class="icon-btn" onclick="togglePause()">游댒</span>
        <div id="clock" style="font-weight: bold; font-family: monospace; color: var(--blue); width: 65px;">00:00:00</div>
    </div>
</nav>

<div id="popup-container"></div>

<aside id="sidebar">
    <div class="config-block">
        <label style="font-size:11px; color:var(--text-dim); font-weight:bold; text-transform:uppercase;">Filtro de Vela</label>
        <div class="grid-tags grid-2">
            <div class="tag-btn active" id="vela-atual" onclick="toggleVela('Atual')">Vela Atual</div>
            <div class="tag-btn active" id="vela-prox" onclick="toggleVela('Pr칩xima')">Pr칩xima Vela</div>
        </div>
    </div>

    <div class="config-block">
        <label style="font-size:11px; color:var(--text-dim); font-weight:bold; text-transform:uppercase;">Timeframe</label>
        <div class="grid-tags grid-4" style="margin-bottom: 5px;">
            <div class="tag-btn tf-btn active" id="tf-M1" onclick="toggleTF('M1')">M1</div>
            <div class="tag-btn tf-btn active" id="tf-M5" onclick="toggleTF('M5')">M5</div>
            <div class="tag-btn tf-btn" id="tf-M10" onclick="toggleTF('M10')">M10</div>
            <div class="tag-btn tf-btn" id="tf-M15" onclick="toggleTF('M15')">M15</div>
        </div>
        <div class="tag-btn" onclick="toggleAllTF()" style="width: 100%; display:block; padding: 6px 0;">Todas</div>
    </div>

    <div class="config-block">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
            <label style="font-size:11px; color:var(--text-dim); font-weight:bold; text-transform:uppercase;">Pares</label>
            <div style="display:flex; gap:5px;">
                <span style="font-size:9px; color:var(--blue); cursor:pointer;" onclick="bulkAssets(true)">Todos</span>
                <span style="font-size:9px; color:var(--text-dim); cursor:pointer;" onclick="bulkAssets(false)">Nenhum</span>
            </div>
        </div>
        <div class="grid-tags grid-3" id="asset-selector"></div>
    </div>

    <div class="config-block">
        <label style="font-size:11px; color:var(--text-dim); font-weight:bold; text-transform:uppercase;">RSI</label>
        <div class="slider-row">
            <div class="slider-header"><span>Per칤odo:</span> <b id="val-rsi-p">14</b></div>
            <input type="range" id="cfg-rsi-p" min="2" max="30" value="14" oninput="syncVal(this, 'val-rsi-p')">
        </div>
        <div class="slider-row">
            <div class="slider-header"><span>Sobrecompra:</span> <b id="val-rsi-up">80</b></div>
            <input type="range" id="cfg-rsi-up" min="50" max="100" value="80" oninput="syncVal(this, 'val-rsi-up')">
        </div>
        <div class="slider-row">
            <div class="slider-header"><span>Sobrevenda:</span> <b id="val-rsi-dw">20</b></div>
            <input type="range" id="cfg-rsi-dw" min="0" max="50" value="20" oninput="syncVal(this, 'val-rsi-dw')">
        </div>
    </div>

    <div class="config-block">
        <label style="font-size:11px; color:var(--text-dim); font-weight:bold; text-transform:uppercase;">MACD</label>
        <div class="slider-row">
            <div class="slider-header"><span>EMA R치pida:</span> <b id="val-macd-f">12</b></div>
            <input type="range" id="cfg-macd-f" min="5" max="30" value="12" oninput="syncVal(this, 'val-macd-f')">
        </div>
        <div class="slider-row">
            <div class="slider-header"><span>EMA Lenta:</span> <b id="val-macd-s">26</b></div>
            <input type="range" id="cfg-macd-s" min="10" max="50" value="26" oninput="syncVal(this, 'val-macd-s')">
        </div>
        <div class="slider-row">
            <div class="slider-header"><span>Sinal:</span> <b id="val-macd-sig">9</b></div>
            <input type="range" id="cfg-macd-sig" min="2" max="20" value="9" oninput="syncVal(this, 'val-macd-sig')">
        </div>
    </div>
</aside>

<main id="main">
    <div class="stats-grid">
        <div class="stat-card"><span>Total</span><h2 id="st-total">0</h2></div>
        <div class="stat-card"><span>Compra</span><h2 id="st-buy" style="color:var(--green)">0</h2></div>
        <div class="stat-card"><span>Venda</span><h2 id="st-sell" style="color:var(--red)">0</h2></div>
        <div class="stat-card"><span>Confirmados</span><h2 id="st-conf" style="color:var(--blue)">0</h2></div>
        <div class="stat-card"><span>Pendentes</span><h2 id="st-pend" style="color:var(--yellow)">0</h2></div>
        <div class="stat-card"><span>Velas Analisadas</span><h2 id="st-velas" style="color:var(--text-main)">Ativas</h2></div>
    </div>

    <div class="table-section">
        <table>
            <thead>
                <tr><th>Hora Sinal</th><th>Par</th><th>Sinal</th><th>TF</th><th>Alvo</th><th>Vela (Abertura)</th><th>RSI</th><th>MACD</th></tr>
            </thead>
            <tbody id="signal-rows"></tbody>
        </table>
    </div>
</main>

<script>
    const ASSETS = ["EUR/USD", "GBP/USD", "AUD/CAD", "EUR/JPY", "BTC/USD", "ETH/USD", "XAUUSD", "SOL/USD"];
    let selectedAssets = new Set(ASSETS);
    let selectedTFs = new Set(['M1', 'M5']);
    let selectedVelas = new Set(['Atual', 'Pr칩xima']);
    
    let isPaused = false;
    let isMuted = false;
    let stats = { total: 0, buy: 0, sell: 0, conf: 0 };

    // FUN칂칏ES DE 츼UDIO
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSignalSound(type) {
        if(isMuted) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.frequency.setValueAtTime(type === 'COMPRA' ? 1050 : 320, audioCtx.currentTime); 
        osc.type = type === 'COMPRA' ? 'sine' : 'triangle';
        gain.gain.setValueAtTime(0.08, audioCtx.currentTime);
        osc.start(); osc.stop(audioCtx.currentTime + 0.25);
    }

    // INICIALIZA칂츾O E CONTROLES DE UI
    function init() {
        document.getElementById('asset-selector').innerHTML = ASSETS.map(a => 
            `<div class="tag-btn active" id="ast-${a.replace('/','')}" onclick="toggleAsset('${a}')">${a}</div>`
        ).join('');
        setInterval(updateClock, 1000);
        setInterval(generateSignal, 6000);
    }

    function syncVal(el, targetId) { document.getElementById(targetId).innerText = el.value; }
    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('hidden'); }
    function toggleAudio() { isMuted = !isMuted; document.getElementById('btn-audio').innerText = isMuted ? '游댆' : '游댉'; }
    function togglePause() { 
        isPaused = !isPaused; 
        document.getElementById('btn-pause').style.color = isPaused ? 'var(--red)' : 'var(--text-main)'; 
    }
    function updateClock() { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }

    // FILTROS MULTI-SELE칂츾O
    function toggleVela(tipo) {
        const id = tipo === 'Atual' ? 'vela-atual' : 'vela-prox';
        const el = document.getElementById(id);
        selectedVelas.has(tipo) ? (selectedVelas.delete(tipo), el.classList.remove('active')) : (selectedVelas.add(tipo), el.classList.add('active'));
        document.getElementById('st-velas').innerText = Array.from(selectedVelas).join(' & ') || 'Nenhuma';
    }

    function toggleTF(tf) {
        const el = document.getElementById(`tf-${tf}`);
        selectedTFs.has(tf) ? (selectedTFs.delete(tf), el.classList.remove('active')) : (selectedTFs.add(tf), el.classList.add('active'));
    }

    function toggleAllTF() {
        const allTFs = ['M1', 'M5', 'M10', 'M15'];
        const isActive = selectedTFs.size > 0;
        allTFs.forEach(tf => {
            const el = document.getElementById(`tf-${tf}`);
            if(isActive) { selectedTFs.delete(tf); el.classList.remove('active'); }
            else { selectedTFs.add(tf); el.classList.add('active'); }
        });
    }

    function toggleAsset(a) {
        const el = document.getElementById(`ast-${a.replace('/','')}`);
        selectedAssets.has(a) ? (selectedAssets.delete(a), el.classList.remove('active')) : (selectedAssets.add(a), el.classList.add('active'));
    }

    function bulkAssets(status) {
        ASSETS.forEach(a => {
            const el = document.getElementById(`ast-${a.replace('/','')}`);
            status ? (selectedAssets.add(a), el.classList.add('active')) : (selectedAssets.delete(a), el.classList.remove('active'));
        });
    }

    // C츼LCULO MATEM츼TICO DA VELA
    function getCandleTime(tf, tipoVela) {
        const now = new Date();
        let minutes = now.getMinutes();
        let hours = now.getHours();
        let step = parseInt(tf.replace('M', '')); // Extrai 1, 5, 10 ou 15
        
        let candleStartMin = Math.floor(minutes / step) * step;
        
        if (tipoVela === 'Pr칩xima') {
            candleStartMin += step;
        }

        if (candleStartMin >= 60) {
            candleStartMin -= 60;
            hours = (hours + 1) % 24;
        }

        return `${hours.toString().padStart(2, '0')}:${candleStartMin.toString().padStart(2, '0')}:00`;
    }

    // GERA칂츾O DE SINAIS
    function generateSignal() {
        if(isPaused || selectedAssets.size === 0 || selectedTFs.size === 0 || selectedVelas.size === 0) return;
        
        // Sorteia base nas sele칞칫es ativas
        const pair = Array.from(selectedAssets)[Math.floor(Math.random() * selectedAssets.size)];
        const tf = Array.from(selectedTFs)[Math.floor(Math.random() * selectedTFs.size)];
        const velaType = Array.from(selectedVelas)[Math.floor(Math.random() * selectedVelas.size)];
        const type = Math.random() > 0.5 ? 'COMPRA' : 'VENDA';
        
        const candleTime = getCandleTime(tf, velaType);
        
        // Simula Indicadores baseados na configura칞칚o atual
        const rsiCfg = document.getElementById('cfg-rsi-p').value;
        const macdCfg = document.getElementById('cfg-macd-f').value;
        const simRSI = (Math.random() * 100).toFixed(1);
        const simMACD = (Math.random() * 2 - 1).toFixed(4);

        playSignalSound(type);
        showPopup(pair, type, tf, velaType);

        // Atualiza Stats
        stats.total++; type === 'COMPRA' ? stats.buy++ : stats.sell++; stats.conf++;
        document.getElementById('st-total').innerText = stats.total;
        document.getElementById('st-buy').innerText = stats.buy;
        document.getElementById('st-sell').innerText = stats.sell;
        document.getElementById('st-conf').innerText = stats.conf;

        const row = `<tr>
            <td>${new Date().toLocaleTimeString()}</td>
            <td><b>${pair}</b></td>
            <td><span class="${type === 'COMPRA' ? 'badge-buy' : 'badge-sell'}">${type}</span></td>
            <td><span style="background:var(--blue); padding:2px 5px; border-radius:3px; font-size:10px;">${tf}</span></td>
            <td style="color:var(--text-dim); font-size:11px;">${velaType}</td>
            <td style="color:white; font-family:monospace; font-size:13px;">${candleTime}</td>
            <td>${simRSI} <span style="font-size:9px; color:var(--text-dim)">(p:${rsiCfg})</span></td>
            <td style="color:${simMACD > 0 ? 'var(--green)' : 'var(--red)'}">${simMACD} <span style="font-size:9px; color:var(--text-dim)">(f:${macdCfg})</span></td>
        </tr>`;
        
        const tbody = document.getElementById('signal-rows');
        tbody.insertAdjacentHTML('afterbegin', row);
        if(tbody.children.length > 20) tbody.lastElementChild.remove();
    }

    function showPopup(pair, type, tf, velaType) {
        const id = Date.now();
        const color = type === 'COMPRA' ? 'var(--green)' : 'var(--red)';
        const html = `
            <div class="popup-alert" id="${id}" style="border-left-color: ${color}">
                <div style="font-size:10px; color:var(--text-dim); margin-bottom:4px;">${tf} | ${velaType} Vela</div>
                <div style="font-weight:bold; color:${color}; font-size:14px;">${type} - ${pair}</div>
            </div>`;
        document.getElementById('popup-container').insertAdjacentHTML('afterbegin', html);
        setTimeout(() => document.getElementById(id)?.remove(), 4500);
    }

    init();
</script>
</body>
</html>